<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mis Juegos</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        header h1:hover {
            color: #ccc;
        }
        .controls {
            position: sticky;
            top: 20px;
            background: #000;
            z-index: 1000;
            padding: 10px 0;
            margin-bottom: 20px;
        }
        .profile-selector {
            margin-bottom: 10px;
        }
        .profile-selector button {
            background: #222;
            color: #fff;
            border: 1px solid #444;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        .profile-selector button.active {
            background: #444;
        }
        .search-bar {
            margin-bottom: 10px;
            text-align: center;
        }
        .search-bar input {
            background: #222;
            color: #fff;
            border: 1px solid #444;
            padding: 5px;
            margin: 0 10px;
            border-radius: 5px;
        }
        .filters {
            margin-bottom: 10px;
            text-align: center;
        }
        .filters select {
            background: #222;
            color: #fff;
            border: 1px solid #444;
            padding: 5px;
            margin: 0 10px;
            border-radius: 5px;
        }
        .games-grid, .main-games-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .game-card, .main-game-card {
            background: #222;
            border-radius: 10px;
            padding: 10px;
            margin: 10px;
            width: 200px;
            display: inline-block;
            vertical-align: top;
            position: relative;
        }
        .game-card img, .main-game-card img {
            width: 100%;
            border-radius: 5px;
        }
        .game-card button {
            background: #600;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
        }
        .game-card .edit-btn { background: #060; }
        .main-game-card button { display: none; }
        h3 { margin: 10px 0 5px 0; }
        p { margin: 5px 0; font-size: 0.9em; }
        .add-form, .edit-form {
            background: #222;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        .add-form.active, .edit-form.active {
            display: block;
        }
        .add-form input, .add-form select, .edit-form input, .edit-form select {
            background: #333;
            color: #fff;
            border: 1px solid #444;
            padding: 5px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .add-form button, .edit-form button {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        .sync-button, .debug-toggle, .auth-button {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .auth-button { background: #4CAF50; }
        #debug {
            margin-top: 20px;
            color: #ff0;
            display: none;
        }
        .debug-active #debug {
            display: block;
        }
        strong { font-weight: bold; }
    </style>
</head>
<body>
    <header onclick="loadProfile('main')">
        <h1>Mis Puntajes de Videojuegos</h1>
    </header>

    <div class="controls">
        <div class="profile-selector">
            <button onclick="loadProfile('z4')">Z4</button>
            <button onclick="loadProfile('shenqi')">Shenqi</button>
            <button onclick="loadProfile('cayden')">Cayden</button>
            <button onclick="toggleForm('add')">Agregar Juego</button>
        </div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Buscar por título..." onkeyup="applySearch()">
        </div>
        <div class="filters">
            <label>Año:</label>
            <select id="filterYear" onchange="applyFiltersAndSearch()">
                <option value="">Selecciona Año</option>
            </select>
            <label>Plataforma:</label>
            <select id="filterPlatform" onchange="applyFiltersAndSearch()">
                <option value="">Selecciona Plataforma</option>
            </select>
        </div>
    </div>

    <div id="mainGamesContainer" class="main-games-grid"></div>
    <div id="gamesContainer" class="games-grid"></div>

    <button class="sync-button" onclick="syncToClipboard()">Copiar Cambios al Portapapeles</button>
    <button class="sync-button" id="syncToSheetsButton" onclick="syncToSheets()" disabled>Sincronizar con Google Sheets</button>
    <button class="auth-button" id="authorizeButton" style="display:none;">Autorizar</button>
    <button class="debug-toggle" onclick="toggleDebug()">Mostrar Depuración</button>
    <div id="debug"></div>

    <form id="addForm" class="add-form">
        <h3>Agregar Nuevo Juego</h3>
        <input type="text" id="gameTitle" placeholder="Título" required>
        <input type="number" id="gameYear" placeholder="Año" min="1900" max="2025" required>
        <select id="gamePlatform" required>
            <option value="">Selecciona Plataforma</option>
            <option value="PC">PC</option>
            <option value="Wii">Wii</option>
            <option value="Switch">Switch</option>
            <option value="PS3">PS3</option>
            <option value="PS4">PS4</option>
            <option value="PS5">PS5</option>
            <option value="Xbox">Xbox</option>
            <option value="Xbox 360">Xbox 360</option>
            <option value="Xbox One">Xbox One</option>
            <option value="Xbox Series X">Xbox Series X</option>
            <option value="GameCube">GameCube</option>
            <option value="NES">NES</option>
            <option value="SNES">SNES</option>
            <option value="N64">N64</option>
            <option value="Game Boy">Game Boy</option>
            <option value="DS">DS</option>
            <option value="3DS">3DS</option>
            <option value="PSP">PSP</option>
            <option value="Vita">Vita</option>
        </select>
        <input type="number" id="gamePuntaje" placeholder="Puntaje" step="0.01" min="0" max="100" required>
        <input type="text" id="gameImage" placeholder="URL de Imagen (ej. https://ejemplo.com/imagen.jpg)" required>
        <button type="button" onclick="addGame()">Guardar</button>
        <button type="button" onclick="toggleForm('add')">Cancelar</button>
    </form>

    <form id="editForm" class="edit-form">
        <h3>Editar Juego</h3>
        <input type="text" id="editGameTitle" placeholder="Título" required>
        <input type="number" id="editGameYear" placeholder="Año" min="1900" max="2025" required>
        <select id="editGamePlatform" required>
            <option value="">Selecciona Plataforma</option>
            <option value="PC">PC</option>
            <option value="Wii">Wii</option>
            <option value="Switch">Switch</option>
            <option value="PS3">PS3</option>
            <option value="PS4">PS4</option>
            <option value="PS5">PS5</option>
            <option value="Xbox">Xbox</option>
            <option value="Xbox 360">Xbox 360</option>
            <option value="Xbox One">Xbox One</option>
            <option value="Xbox Series X">Xbox Series X</option>
            <option value="GameCube">GameCube</option>
            <option value="NES">NES</option>
            <option value="SNES">SNES</option>
            <option value="N64">N64</option>
            <option value="Game Boy">Game Boy</option>
            <option value="DS">DS</option>
            <option value="3DS">3DS</option>
            <option value="PSP">PSP</option>
            <option value="Vita">Vita</option>
        </select>
        <input type="number" id="editGamePuntaje" placeholder="Puntaje" step="0.01" min="0" max="100" required>
        <input type="text" id="editGameImage" placeholder="URL de Imagen (ej. https://ejemplo.com/imagen.jpg)" required>
        <button type="button" onclick="saveEdit()">Guardar</button>
        <button type="button" onclick="toggleForm('edit')">Cancelar</button>
    </form>

    <script>
        let data = {};
        let currentProfile = 'main';
        let allGames = [];
        let editIndex = -1;
        let debugEnabled = false;
        let gapi = window.gapi;
        let CLIENT_ID = '519904327905-mr1hfksujfh218vphe9j9s70e3lh0hff.apps.googleusercontent.com'; // Tu client_id
        let API_KEY = 'AIzaSyBlzM9xHLj4b0nZqUR0DkzPbh8RgZyQtBc';
        let DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
        let SCOPES = "https://www.googleapis.com/auth/spreadsheets";
        const SPREADSHEET_ID = '1gauIcXDfqgYTGHGSTojlULZc6LPTQMTRpX-9Lqfm8pg';

        function onGapiLoad() {
            console.log('gapi cargado correctamente');
            document.getElementById('debug').innerHTML += '<br>gapi cargado correctamente.';
            if (typeof gapi !== 'undefined' && gapi) {
                initClient();
            } else {
                console.error('gapi no está definido');
                document.getElementById('debug').innerHTML += '<br>Error: gapi no está definido.';
            }
        }

        function onGapiError() {
            console.error('Error al cargar gapi');
            document.getElementById('debug').innerHTML += '<br>Error al cargar gapi.';
        }

        function initClient() {
            console.log('Iniciando cliente...');
            document.getElementById('debug').innerHTML += '<br>Iniciando cliente...';
            try {
                gapi.load('client:auth2', () => {
                    gapi.client.init({
                        apiKey: API_KEY,
                        clientId: CLIENT_ID,
                        discoveryDocs: DISCOVERY_DOCS,
                        scope: SCOPES
                    }).then(() => {
                        console.log('Cliente inicializado');
                        document.getElementById('debug').innerHTML += '<br>Cliente inicializado.';
                        const authInstance = gapi.auth2.getAuthInstance();
                        if (!authInstance.isSignedIn.get()) {
                            document.getElementById('authorizeButton').style.display = 'block';
                            document.getElementById('authorizeButton').onclick = handleAuthClick;
                        } else {
                            document.getElementById('syncToSheetsButton').disabled = false;
                            loadData();
                        }
                    }, error => {
                        console.error('Error en initClient:', error);
                        document.getElementById('debug').innerHTML += '<br>Error en initClient: ' + error.details;
                    });
                });
            } catch (error) {
                console.error('Error al inicializar gapi:', error);
                document.getElementById('debug').innerHTML += '<br>Error al inicializar gapi: ' + error.message;
            }
        }

        function handleAuthClick() {
            console.log('Iniciando autenticación...');
            document.getElementById('debug').innerHTML += '<br>Iniciando autenticación...';
            gapi.auth2.getAuthInstance().signIn().then(() => {
                console.log('Autenticación exitosa');
                document.getElementById('debug').innerHTML += '<br>Autenticación exitosa.';
                document.getElementById('authorizeButton').style.display = 'none';
                document.getElementById('syncToSheetsButton').disabled = false;
                loadData();
            }, error => {
                console.error('Error en autenticación:', error);
                document.getElementById('debug').innerHTML += '<br>Error en autenticación: ' + error.details;
            });
        }

        // Cargar datos desde Google Sheets
        function loadData() {
            const debugDiv = document.getElementById('debug');
            if (debugEnabled) debugDiv.innerHTML += '<br>Cargando datos...';
            fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/A:F?key=${API_KEY}`)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(dataResponse => {
                    const rows = dataResponse.values;
                    if (debugEnabled) debugDiv.innerHTML += '<br>Respuesta recibida: ' + JSON.stringify(rows);
                    if (rows && rows.length > 1) {
                        data = { z4: [], shenqi: [], cayden: [] };
                        for (let i = 1; i < rows.length; i++) {
                            const [perfil, titulo, año, plataforma, puntaje, img] = rows[i] || [];
                            if (perfil && titulo && año && plataforma && puntaje && img) {
                                data[perfil.toLowerCase()].push({
                                    titulo: titulo,
                                    año: parseInt(año),
                                    plataforma: plataforma,
                                    puntaje: parseFloat(puntaje),
                                    img: img
                                });
                                if (debugEnabled) debugDiv.innerHTML += `<br>Fila ${i + 1} procesada: ${perfil}, ${titulo}, ${año}, ${plataforma}, ${puntaje}, ${img}`;
                            }
                        }
                        localStorage.setItem('gameData', JSON.stringify(data)); // Guardar en localStorage como respaldo
                        if (debugEnabled) debugDiv.innerHTML += `<br>Datos cargados desde Google Sheets: ${rows.length - 1} filas procesadas.`;
                        updateDisplay();
                    } else {
                        if (debugEnabled) debugDiv.innerHTML += '<br>No se encontraron datos válidos en la hoja.';
                    }
                })
                .catch(error => {
                    if (debugEnabled) debugDiv.innerHTML += `<br>Error al cargar datos: ${error.message}`;
                    console.error('Error details:', error);
                    const savedData = localStorage.getItem('gameData');
                    if (savedData) {
                        data = JSON.parse(savedData);
                        updateDisplay();
                    }
                });
        }

        // Sincronizar datos con Google Sheets
        function syncToSheets() {
            const debugDiv = document.getElementById('debug');
            if (debugEnabled) debugDiv.innerHTML += '<br>Iniciando sincronización con Google Sheets...';
            const values = [
                ['Perfil', 'Título', 'Año', 'Plataforma', 'Puntaje', 'Imagen'],
                ...Object.entries(data).flatMap(([profile, games]) =>
                    games.map(game => [profile, game.titulo, game.año, game.plataforma, game.puntaje, game.img])
                )
            ];
            gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: SPREADSHEET_ID,
                range: 'A1',
                valueInputOption: 'RAW',
                resource: { values: values }
            }).then(response => {
                if (debugEnabled) debugDiv.innerHTML += '<br>Sincronización exitosa.';
                console.log('Sincronización exitosa:', response);
                localStorage.setItem('gameData', JSON.stringify(data)); // Actualizar localStorage
                alert('Datos sincronizados con Google Sheets.');
            }, error => {
                if (debugEnabled) debugDiv.innerHTML += '<br>Error en sincronización: ' + error.result.error.message;
                console.error('Error en sincronización:', error);
                alert('Error al sincronizar. Revisa la consola o depuración.');
            });
        }

        // Sincronización automática tras cambios
        function autoSync() {
            const authInstance = gapi.auth2.getAuthInstance();
            if (authInstance && authInstance.isSignedIn.get()) {
                syncToSheets();
            } else {
                alert('Debes autorizar la aplicación para sincronizar automáticamente.');
            }
        }

        // Actualizar la interfaz
        function updateDisplay() {
            if (currentProfile !== 'main') {
                allGames = data[currentProfile] || [];
                updateFilters();
                applyFiltersAndSearch();
            } else {
                renderMainGames();
            }
        }

        window.onload = function() {
            loadData();
            loadProfile('main');
        };

        function loadProfile(profile) {
            currentProfile = profile;
            if (profile === 'main') {
                document.getElementById('gamesContainer').style.display = 'none';
                document.getElementById('mainGamesContainer').style.display = 'flex';
                renderMainGames();
                updateFiltersForMain();
            } else {
                document.getElementById('mainGamesContainer').style.display = 'none';
                document.getElementById('gamesContainer').style.display = 'flex';
                allGames = data[profile] || [];
                updateFilters();
                applyFiltersAndSearch();
            }
            const buttons = document.querySelectorAll('.profile-selector button');
            buttons.forEach(btn => btn.classList.remove('active'));
            const activeButton = document.querySelector(`.profile-selector button[onclick="loadProfile('${profile}')"]`);
            if (activeButton) activeButton.classList.add('active');
        }

        function updateFilters() {
            const years = allGames.length > 0 ? [...new Set(allGames.map(g => g.año))].sort((a, b) => b - a) : [];
            const platforms = allGames.length > 0 ? [...new Set(allGames.map(g => g.plataforma))].sort() : [];
            const yearSelect = document.getElementById('filterYear');
            yearSelect.innerHTML = '<option value="">Selecciona Año</option>' + (years.length > 0 ? years.map(y => `<option value="${y}">${y}</option>`).join('') : '');
            const platformSelect = document.getElementById('filterPlatform');
            platformSelect.innerHTML = '<option value="">Selecciona Plataforma</option>' + (platforms.length > 0 ? platforms.map(p => `<option value="${p}">${p}</option>`).join('') : '');
        }

        function updateFiltersForMain() {
            const allGamesData = [];
            for (let profile in data) {
                data[profile].forEach(game => allGamesData.push(game));
            }
            const years = allGamesData.length > 0 ? [...new Set(allGamesData.map(g => g.año))].sort((a, b) => b - a) : [];
            const platforms = allGamesData.length > 0 ? [...new Set(allGamesData.map(g => g.plataforma))].sort() : [];
            const yearSelect = document.getElementById('filterYear');
            yearSelect.innerHTML = '<option value="">Selecciona Año</option>' + (years.length > 0 ? years.map(y => `<option value="${y}">${y}</option>`).join('') : '');
            const platformSelect = document.getElementById('filterPlatform');
            platformSelect.innerHTML = '<option value="">Selecciona Plataforma</option>' + (platforms.length > 0 ? platforms.map(p => `<option value="${p}">${p}</option>`).join('') : '');
        }

        function applyFiltersAndSearch() {
            const selectedYear = document.getElementById('filterYear').value;
            const selectedPlatform = document.getElementById('filterPlatform').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            let filteredGames;
            if (currentProfile !== 'main') {
                filteredGames = allGames.filter(game => {
                    return (!selectedYear || game.año == selectedYear) &&
                           (!selectedPlatform || game.plataforma === selectedPlatform) &&
                           (!searchTerm || game.titulo.toLowerCase().includes(searchTerm));
                });
            } else {
                const allGamesData = [];
                for (let profile in data) {
                    data[profile].forEach(game => allGamesData.push({ ...game, profile }));
                }
                filteredGames = allGamesData.filter(game => {
                    return (!selectedYear || game.año == selectedYear) &&
                           (!selectedPlatform || game.plataforma === selectedPlatform) &&
                           (!searchTerm || game.titulo.toLowerCase().includes(searchTerm));
                });
            }
            filteredGames.sort((a, b) => b.puntaje - a.puntaje);
            if (currentProfile !== 'main') {
                renderGames(filteredGames);
            } else {
                renderMainGamesWithFilter('', filteredGames);
            }
        }

        function applySearch() {
            if (currentProfile !== 'main') {
                applyFiltersAndSearch();
            } else {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                renderMainGamesWithFilter(searchTerm);
            }
        }

        function renderGames(games) {
            const container = document.getElementById('gamesContainer');
            container.innerHTML = '';
            games.forEach((game, index) => {
                const allPuntajes = [];
                for (let profile in data) {
                    const foundGame = data[profile].find(g => g.titulo === game.titulo && g.año === game.año && g.plataforma === game.plataforma);
                    if (foundGame) allPuntajes.push({ profile, puntaje: foundGame.puntaje });
                }
                const puntajesText = allPuntajes.map(p => `${p.profile}: ${p.puntaje}`).join('<br>');
                const currentProfilePuntaje = game.puntaje; // Puntaje del perfil actual
                const card = document.createElement('div');
                card.className = 'game-card';
                card.innerHTML = `
                    <img src="${game.img}" alt="${game.titulo}" onerror="this.src='https://via.placeholder.com/200x280/444/fff?text=${game.titulo}'">
                    <h3>${game.titulo}</h3>
                    <p>${game.año} | ${game.plataforma}</p>
                    <p>Puntajes:<br>${puntajesText}</p>
                    <p>Promedio: ${(allPuntajes.length > 0 ? (allPuntajes.reduce((a, b) => a + b.puntaje, 0) / allPuntajes.length).toFixed(2) : game.puntaje)}</p>
                    <p><strong>Puntaje (${currentProfile}): ${currentProfilePuntaje}</strong></p>
                    <button class="edit-btn" onclick="editGame(${index})">Editar</button>
                    <button onclick="deleteGame(${index})">Eliminar</button>
                `;
                container.appendChild(card);
            });
        }

        function renderMainGamesWithFilter(searchTerm = '', filteredGames = null) {
            const allGamesData = filteredGames || [];
            if (!filteredGames) {
                for (let profile in data) {
                    data[profile].forEach(game => allGamesData.push({ ...game, profile }));
                }
            }
            const uniqueGames = {};
            allGamesData.forEach(game => {
                const key = `${game.titulo}-${game.año}-${game.plataforma}`;
                if (!uniqueGames[key]) {
                    uniqueGames[key] = { ...game, puntajes: [], profiles: [] };
                }
                uniqueGames[key].puntajes.push(game.puntaje);
                uniqueGames[key].profiles.push(game.profile);
            });

            const gamesArray = Object.values(uniqueGames).filter(game =>
                !searchTerm || game.titulo.toLowerCase().includes(searchTerm)
            );
            gamesArray.sort((a, b) => {
                const avgA = a.puntajes.reduce((sum, p) => sum + p, 0) / a.puntajes.length;
                const avgB = b.puntajes.reduce((sum, p) => sum + p, 0) / b.puntajes.length;
                return avgB - avgA;
            });

            const container = document.getElementById('mainGamesContainer');
            container.innerHTML = '';
            gamesArray.forEach(game => {
                const puntajesText = game.puntajes.map((p, i) => `${game.profiles[i]}: ${p}`).join('<br>');
                const promedio = game.puntajes.reduce((sum, p) => sum + p, 0) / game.puntajes.length;
                const card = document.createElement('div');
                card.className = 'main-game-card';
                card.innerHTML = `
                    <img src="${game.img}" alt="${game.titulo}" onerror="this.src='https://via.placeholder.com/200x280/444/fff?text=${game.titulo}'">
                    <h3>${game.titulo}</h3>
                    <p>${game.año} | ${game.plataforma}</p>
                    <p>Puntajes:<br>${puntajesText}</p>
                    <p>Promedio: <strong>${promedio.toFixed(2)}</strong></p>
                `;
                container.appendChild(card);
            });
        }

        function renderMainGames() {
            renderMainGamesWithFilter('');
        }

        function toggleForm(formType, index = -1) {
            const addForm = document.getElementById('addForm');
            const editForm = document.getElementById('editForm');
            addForm.classList.remove('active');
            editForm.classList.remove('active');
            if (formType === 'add') {
                addForm.classList.add('active');
                addForm.reset();
            } else if (formType === 'edit' && index >= 0) {
                editForm.classList.add('active');
                editIndex = index;
                const game = allGames[index];
                document.getElementById('editGameTitle').value = game.titulo;
                document.getElementById('editGameYear').value = game.año;
                document.getElementById('editGamePlatform').value = game.plataforma;
                document.getElementById('editGamePuntaje').value = game.puntaje;
                document.getElementById('editGameImage').value = game.img;
            }
        }

        function addGame() {
            const titulo = document.getElementById('gameTitle').value;
            const año = parseInt(document.getElementById('gameYear').value);
            const plataforma = document.getElementById('gamePlatform').value;
            const puntaje = parseFloat(document.getElementById('gamePuntaje').value);
            const img = document.getElementById('gameImage').value;

            if (titulo && año && plataforma && !isNaN(puntaje) && img) {
                if (!data[currentProfile]) data[currentProfile] = [];
                data[currentProfile].push({ titulo, año, plataforma, puntaje, img });
                localStorage.setItem('gameData', JSON.stringify(data));
                updateDisplay();
                toggleForm('add');
                autoSync(); // Sincronizar automáticamente
            } else {
                alert('Por favor, completa todos los campos correctamente.');
            }
        }

        function editGame(index) {
            toggleForm('edit', index);
        }

        function saveEdit() {
            const titulo = document.getElementById('editGameTitle').value;
            const año = parseInt(document.getElementById('editGameYear').value);
            const plataforma = document.getElementById('editGamePlatform').value;
            const puntaje = parseFloat(document.getElementById('editGamePuntaje').value);
            const img = document.getElementById('editGameImage').value;

            if (titulo && año && plataforma && !isNaN(puntaje) && img && editIndex >= 0) {
                data[currentProfile][editIndex] = { titulo, año, plataforma, puntaje, img };
                localStorage.setItem('gameData', JSON.stringify(data));
                updateDisplay();
                toggleForm('edit');
                autoSync(); // Sincronizar automáticamente
            } else {
                alert('Por favor, completa todos los campos correctamente.');
            }
        }

        function deleteGame(index) {
            if (confirm('¿Estás seguro de eliminar este juego?')) {
                data[currentProfile].splice(index, 1);
                localStorage.setItem('gameData', JSON.stringify(data));
                updateDisplay();
                autoSync(); // Sincronizar automáticamente
            }
        }

        function syncToClipboard() {
            const csvContent = [
                ['Perfil', 'Título', 'Año', 'Plataforma', 'Puntaje', 'Imagen'],
                ...Object.entries(data).flatMap(([profile, games]) =>
                    games.map(game => [profile, game.titulo, game.año, game.plataforma, game.puntaje, game.img])
                )
            ].map(row => row.join(',')).join('\n');
            navigator.clipboard.writeText(csvContent).then(() => {
                alert('Datos copiados al portapapeles. Pégalos en Google Sheets (reemplaza la hoja).');
            }).catch(err => {
                alert('Error al copiar: ' + err);
            });
        }

        function toggleDebug() {
            debugEnabled = !debugEnabled;
            document.body.classList.toggle('debug-active', debugEnabled);
            const debugButton = document.querySelector('.debug-toggle');
            debugButton.textContent = debugEnabled ? 'Ocultar Depuración' : 'Mostrar Depuración';
            if (!debugEnabled) {
                document.getElementById('debug').innerHTML = '';
            } else {
                loadData();
            }
        }
    </script>
    <script src="https://apis.google.com/js/api.js" onload="onGapiLoad()" onerror="onGapiError()"></script>
</body>
</html>
